spring:
  datasource:
    url: ${DATABASE_URL:jdbc:h2:mem:testdb}
    driver-class-name: ${DATABASE_DRIVER:org.h2.Driver}

  sql:
    init:
      mode: always
      data-locations: classpath:data.sql
  
  h2:
    console:
      enabled: true
  
  jpa:
    hibernate:
      ddl-auto: update
    defer-datasource-initialization: true
    show-sql: true
    open-in-view: false
    database-platform: org.hibernate.dialect.H2Dialect
  
  # Disable Thymeleaf template checking
  thymeleaf:
    check-template-location: false

# JWT Configuration
app:
  jwt:
    secret: bXlTZWNyZXRLZXlGb3JKV1RUb2tlbkdlbmVyYXRpb25UaGF0SXNTZWN1cmVFbm91Z2hGb3JITUFDMjU2QWxnb3JpdGht
    expiration: 86400
  
  # Default Owner User Configuration
  default:
    owner:
      email: owner@geriatriccare.com
      password: Owner123!
      firstName: System
      lastName: Owner

# Server Configuration
server:
  port: 8080

# Logging
logging:
  level:
    com.geriatriccare: DEBUG
    org.springframework.security: DEBUG

# AI Configuration
ai:
  openai:
    api-key: ${OPENAI_API_KEY:your-api-key-here}
    api-url: https://api.openai.com/v1/chat/completions
    model: gpt-4
    max-tokens: 2000
    temperature: 0.3  # Lower for medical precision (0.0 - 1.0)
    timeout: 30000    # 30 seconds timeout
    max-retries: 3
    retry-delay: 1000 # 1 second initial delay
    
  # Circuit Breaker Configuration
  circuit-breaker:
    failure-rate-threshold: 50      # Open circuit at 50% failure rate
    wait-duration-in-open-state: 60 # 60 seconds
    sliding-window-size: 10
    minimum-number-of-calls: 5
    
  # Cache Configuration
  cache:
    enabled: true
    ttl: 3600000      # 1 hour in milliseconds
    max-size: 1000    # Maximum cached responses

# Resilience4j Configuration
resilience4j:
  circuitbreaker:
    instances:
      openai:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 60s
        failureRateThreshold: 50
        recordExceptions:
          - org.springframework.web.client.HttpServerErrorException
          - java.io.IOException
          - java.util.concurrent.TimeoutException
          
  retry:
    instances:
      openai:
        maxAttempts: 3
        waitDuration: 1s
        exponentialBackoffMultiplier: 2
        retryExceptions:
          - org.springframework.web.client.ResourceAccessException
          - java.net.SocketTimeoutException

# Actuator for monitoring
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus
  metrics:
    tags:
      application: ${spring.application.name}
